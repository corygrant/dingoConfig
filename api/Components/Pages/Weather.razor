@page "/weather"
@attribute [StreamRendering]

<PageTitle>Weather</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudText Typo="Typo.h3" Class="mb-4">Weather Forecast</MudText>
    <MudText Typo="Typo.body1" Class="mb-4">This component demonstrates showing data with MudBlazor table.</MudText>

    @if (forecasts == null)
    {
        <MudProgressLinear Indeterminate="true" Class="my-4" />
        <MudText Typo="Typo.body2" Color="Color.Secondary">Loading weather data...</MudText>
    }
    else
    {
        <MudTable Items="@forecasts"
                  Hover="true"
                  Striped="true"
                  Elevation="2"
                  Dense="false">
            <HeaderContent>
                <MudTh>Date</MudTh>
                <MudTh>
                    <MudTooltip Text="Temperature in Celsius">
                        Temp. (C)
                    </MudTooltip>
                </MudTh>
                <MudTh>
                    <MudTooltip Text="Temperature in Fahrenheit">
                        Temp. (F)
                    </MudTooltip>
                </MudTh>
                <MudTh>Summary</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Date">@context.Date.ToShortDateString()</MudTd>
                <MudTd DataLabel="Temp. (C)">
                    <MudChip T="string" Size="Size.Small" Color="@GetTempColor(context.TemperatureC)">
                        @context.TemperatureC°
                    </MudChip>
                </MudTd>
                <MudTd DataLabel="Temp. (F)">@context.TemperatureF°</MudTd>
                <MudTd DataLabel="Summary">
                    <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined">
                        @context.Summary
                    </MudChip>
                </MudTd>
            </RowTemplate>
        </MudTable>
    }
</MudContainer>

@code {
    private WeatherForecast[]? forecasts;

    protected override async Task OnInitializedAsync()
    {
        // Simulate asynchronous loading to demonstrate streaming rendering
        await Task.Delay(500);

        var startDate = DateOnly.FromDateTime(DateTime.Now);
        var summaries = new[] { "Freezing", "Bracing", "Chilly", "Cool", "Mild", "Warm", "Balmy", "Hot", "Sweltering", "Scorching" };
        forecasts = Enumerable.Range(1, 5).Select(index => new WeatherForecast
        {
            Date = startDate.AddDays(index),
            TemperatureC = Random.Shared.Next(-20, 55),
            Summary = summaries[Random.Shared.Next(summaries.Length)]
        }).ToArray();
    }

    private Color GetTempColor(int tempC)
    {
        if (tempC < 0) return Color.Info;
        if (tempC < 10) return Color.Primary;
        if (tempC < 20) return Color.Success;
        if (tempC < 30) return Color.Warning;
        return Color.Error;
    }

    private class WeatherForecast
    {
        public DateOnly Date { get; set; }
        public int TemperatureC { get; set; }
        public string? Summary { get; set; }
        public int TemperatureF => 32 + (int)(TemperatureC / 0.5556);
    }
}
